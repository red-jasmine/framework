# 商品领域深度国际化表结构设计方案

> 基于 Shopify、Magento、Amazon 等国际电商平台的设计理念

## 设计理念

### 核心原则

```
🌍 多市场支持    - 不同国家/地区独立运营
🌐 多语言内容    - 完整的翻译体系
💰 多货币定价    - 地区化定价策略
📦 本地化物流    - 地区物流规则
💳 本地化支付    - 地区支付方式
🏛️ 税务合规     - 各国税收政策
🎯 地区限制     - 销售区域控制
📊 EAV灵活属性   - 动态属性系统
```

## 一、核心表结构

### 1.1 商品主表（Products）

```sql
CREATE TABLE products (
    -- ============ 主键 ============
    id BIGINT UNSIGNED PRIMARY KEY COMMENT 'Global Product ID',
    uuid CHAR(36) UNIQUE NOT NULL COMMENT 'Global UUID for API',
    
    -- ============ 租户/所有者 ============
    tenant_id BIGINT UNSIGNED NOT NULL COMMENT 'Multi-tenant ID',
    owner_type VARCHAR(64) NOT NULL COMMENT 'Owner polymorphic type',
    owner_id VARCHAR(64) NOT NULL COMMENT 'Owner polymorphic ID',
    
    -- ============ 全球唯一标识 ============
    global_sku VARCHAR(100) UNIQUE COMMENT 'Global SKU across all markets',
    handle VARCHAR(255) UNIQUE NOT NULL COMMENT 'URL-friendly identifier',
    gtin VARCHAR(14) UNIQUE COMMENT 'Global Trade Item Number (GTIN-14)',
    
    -- ============ 商品类型 ============
    product_type VARCHAR(64) NOT NULL COMMENT 'physical, digital, service, bundle',
    template_suffix VARCHAR(64) COMMENT 'Theme template to use',
    
    -- ============ 分类（全局）============
    primary_category_id BIGINT UNSIGNED COMMENT 'Primary global category',
    brand_id BIGINT UNSIGNED COMMENT 'Brand ID',
    vendor_id BIGINT UNSIGNED COMMENT 'Vendor/Supplier ID',
    manufacturer_id BIGINT UNSIGNED COMMENT 'Manufacturer ID',
    
    -- ============ 变体配置 ============
    has_variants BOOLEAN DEFAULT false COMMENT 'Has multiple variants',
    variant_options JSON COMMENT 'Variant option structure',
    /* 示例:
    {
        "options": [
            {"name": "Color", "position": 1},
            {"name": "Size", "position": 2}
        ]
    }
    */
    
    -- ============ 全球基础属性 ============
    is_taxable BOOLEAN DEFAULT true COMMENT 'Subject to taxes',
    requires_shipping BOOLEAN DEFAULT true COMMENT 'Requires shipping',
    is_physical BOOLEAN DEFAULT true COMMENT 'Is physical product',
    is_downloadable BOOLEAN DEFAULT false COMMENT 'Has downloadable content',
    is_customizable BOOLEAN DEFAULT false COMMENT 'Supports customization',
    
    -- ============ 年龄限制 ============
    age_restricted BOOLEAN DEFAULT false COMMENT 'Age verification required',
    minimum_age TINYINT UNSIGNED COMMENT 'Minimum age requirement',
    
    -- ============ 合规性 ============
    requires_license BOOLEAN DEFAULT false COMMENT 'License required for purchase',
    hazmat BOOLEAN DEFAULT false COMMENT 'Hazardous materials',
    prescription_required BOOLEAN DEFAULT false COMMENT 'Prescription required',
    
    -- ============ 全球库存策略 ============
    track_inventory BOOLEAN DEFAULT true COMMENT 'Enable inventory tracking',
    inventory_policy VARCHAR(32) DEFAULT 'deny' COMMENT 'deny|continue|backorder',
    backorder_allowed BOOLEAN DEFAULT false COMMENT 'Allow backorders',
    
    -- ============ 全球SEO ============
    default_locale VARCHAR(10) DEFAULT 'en-US' COMMENT 'Default language',
    
    -- ============ 状态管理 ============
    status VARCHAR(32) DEFAULT 'draft' COMMENT 'draft|active|archived',
    published_scope VARCHAR(32) DEFAULT 'global' COMMENT 'global|web|pos',
    
    -- ============ 审计字段 ============
    created_by_type VARCHAR(64),
    created_by_id VARCHAR(64),
    updated_by_type VARCHAR(64),
    updated_by_id VARCHAR(64),
    version BIGINT UNSIGNED DEFAULT 0 COMMENT 'Optimistic locking',
    
    -- ============ 时间戳（UTC）============
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    -- ============ 索引 ============
    INDEX idx_tenant (tenant_id),
    INDEX idx_owner (owner_type, owner_id),
    INDEX idx_handle (handle),
    INDEX idx_gtin (gtin),
    INDEX idx_status (status),
    INDEX idx_category (primary_category_id),
    INDEX idx_brand (brand_id),
    FULLTEXT idx_search (global_sku)
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Global products master table';
```

### 1.2 商品变体表（Product Variants）

```sql
CREATE TABLE product_variants (
    -- ============ 主键 ============
    id BIGINT UNSIGNED PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,
    product_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 租户 ============
    tenant_id BIGINT UNSIGNED NOT NULL,
    owner_type VARCHAR(64) NOT NULL,
    owner_id VARCHAR(64) NOT NULL,
    
    -- ============ 全球标识 ============
    sku VARCHAR(100) UNIQUE NOT NULL COMMENT 'Global SKU',
    barcode VARCHAR(64) COMMENT 'UPC/EAN/ISBN',
    barcode_type VARCHAR(32) COMMENT 'UPC|EAN13|EAN8|ISBN|JAN|ITF',
    
    -- ============ 选项值（最多3个）============
    option1_value VARCHAR(255) COMMENT 'Option 1 value ID',
    option2_value VARCHAR(255) COMMENT 'Option 2 value ID',
    option3_value VARCHAR(255) COMMENT 'Option 3 value ID',
    
    -- ============ 全球基础价格（基准货币）============
    base_currency CHAR(3) DEFAULT 'USD' COMMENT 'Base currency for calculations',
    base_price DECIMAL(12,2) NOT NULL COMMENT 'Base price in base currency',
    base_cost DECIMAL(12,2) COMMENT 'Base cost in base currency',
    base_compare_at_price DECIMAL(12,2) COMMENT 'Base MSRP',
    
    -- ============ 全球库存（汇总）============
    global_inventory_quantity BIGINT DEFAULT 0 COMMENT 'Total across all warehouses',
    allocated_quantity BIGINT DEFAULT 0 COMMENT 'Reserved/allocated',
    available_quantity BIGINT DEFAULT 0 COMMENT 'Available for sale',
    
    -- ============ 物理属性（SI标准单位）============
    weight DECIMAL(10,3) COMMENT 'Weight in kg',
    length DECIMAL(8,2) COMMENT 'Length in meters',
    width DECIMAL(8,2) COMMENT 'Width in meters',
    height DECIMAL(8,2) COMMENT 'Height in meters',
    volume DECIMAL(10,4) COMMENT 'Volume in cubic meters',
    
    -- ============ 包装信息 ============
    package_weight DECIMAL(10,3) COMMENT 'Weight with packaging (kg)',
    package_length DECIMAL(8,2) COMMENT 'Package length (m)',
    package_width DECIMAL(8,2) COMMENT 'Package width (m)',
    package_height DECIMAL(8,2) COMMENT 'Package height (m)',
    
    -- ============ 物流属性 ============
    requires_shipping BOOLEAN DEFAULT true,
    taxable BOOLEAN DEFAULT true,
    fulfillment_service VARCHAR(64) DEFAULT 'manual' COMMENT 'Fulfillment service',
    
    -- ============ 国际贸易 ============
    origin_country CHAR(2) COMMENT 'ISO 3166-1 alpha-2',
    hs_code VARCHAR(16) COMMENT 'Harmonized System code',
    
    -- ============ 媒体 ============
    image_id BIGINT UNSIGNED COMMENT 'Primary image',
    position TINYINT UNSIGNED DEFAULT 1 COMMENT 'Display order',
    
    -- ============ 状态 ============
    status VARCHAR(32) DEFAULT 'active',
    
    -- ============ 审计 ============
    created_by_type VARCHAR(64),
    created_by_id VARCHAR(64),
    updated_by_type VARCHAR(64),
    updated_by_id VARCHAR(64),
    version BIGINT UNSIGNED DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    
    -- ============ 索引 ============
    INDEX idx_product (product_id),
    INDEX idx_tenant (tenant_id),
    INDEX idx_sku (sku),
    INDEX idx_barcode (barcode),
    INDEX idx_status (status),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Global product variants';
```

## 二、多语言翻译体系

### 2.1 商品翻译表

```sql
CREATE TABLE product_translations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    locale VARCHAR(10) NOT NULL COMMENT 'en-US, zh-CN, ja-JP',
    
    -- ============ 基础内容 ============
    title VARCHAR(500) NOT NULL COMMENT 'Product title',
    subtitle VARCHAR(500) COMMENT 'Product subtitle/tagline',
    description TEXT COMMENT 'Product description',
    description_html TEXT COMMENT 'Rich HTML description',
    
    -- ============ SEO ============
    meta_title VARCHAR(255),
    meta_description TEXT,
    meta_keywords JSON COMMENT 'Keywords array',
    
    -- ============ 营销内容 ============
    marketing_description TEXT COMMENT 'Marketing copy',
    highlights JSON COMMENT 'Key features array',
    specifications JSON COMMENT 'Technical specs',
    
    -- ============ 法律合规 ============
    legal_disclaimer TEXT COMMENT 'Legal disclaimer',
    warning_label TEXT COMMENT 'Warning labels',
    care_instructions TEXT COMMENT 'Care instructions',
    
    -- ============ 状态 ============
    is_published BOOLEAN DEFAULT false,
    published_at TIMESTAMP NULL,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_locale (product_id, locale),
    INDEX idx_locale (locale),
    FULLTEXT idx_search (title, description),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Product multi-language translations';
```

### 2.2 变体翻译表

```sql
CREATE TABLE variant_translations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    variant_id BIGINT UNSIGNED NOT NULL,
    locale VARCHAR(10) NOT NULL,
    
    title VARCHAR(255) COMMENT 'Variant display title',
    option1_name VARCHAR(100) COMMENT 'Translated option 1 value',
    option2_name VARCHAR(100) COMMENT 'Translated option 2 value',
    option3_name VARCHAR(100) COMMENT 'Translated option 3 value',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_variant_locale (variant_id, locale),
    
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 2.3 选项翻译表

```sql
CREATE TABLE product_option_translations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    locale VARCHAR(10) NOT NULL,
    
    options JSON NOT NULL COMMENT 'Translated option structure',
    /* 示例:
    {
        "options": [
            {
                "name": "颜色",
                "position": 1,
                "values": [
                    {"value_id": "red", "display": "红色"},
                    {"value_id": "blue", "display": "蓝色"}
                ]
            }
        ]
    }
    */
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_locale (product_id, locale),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 三、多市场定价体系

### 3.1 市场定义表

```sql
CREATE TABLE markets (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(32) UNIQUE NOT NULL COMMENT 'Market code: US, CN, EU-DE',
    name VARCHAR(100) NOT NULL,
    
    -- ============ 地理范围 ============
    type VARCHAR(32) NOT NULL COMMENT 'country|region|global',
    countries JSON COMMENT 'ISO country codes array',
    regions JSON COMMENT 'Sub-regions/states',
    
    -- ============ 货币配置 ============
    primary_currency CHAR(3) NOT NULL COMMENT 'Primary currency',
    supported_currencies JSON COMMENT 'Additional currencies',
    
    -- ============ 语言配置 ============
    primary_locale VARCHAR(10) NOT NULL COMMENT 'Primary language',
    supported_locales JSON COMMENT 'Additional languages',
    
    -- ============ 时区 ============
    timezone VARCHAR(64) COMMENT 'Market timezone',
    
    -- ============ 税务配置 ============
    tax_inclusive_pricing BOOLEAN DEFAULT false COMMENT 'Prices include tax',
    tax_name VARCHAR(100) COMMENT 'Tax display name: VAT, GST, Sales Tax',
    default_tax_rate DECIMAL(5,4) COMMENT 'Default tax rate',
    
    -- ============ 运营配置 ============
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0 COMMENT 'Market priority',
    
    -- ============ 元数据 ============
    metadata JSON COMMENT 'Additional market config',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_active (is_active),
    INDEX idx_priority (priority)
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Global markets definition';

-- 插入示例数据
INSERT INTO markets (code, name, type, countries, primary_currency, primary_locale, tax_inclusive_pricing) VALUES
('US', 'United States', 'country', '["US"]', 'USD', 'en-US', false),
('CN', 'China', 'country', '["CN"]', 'CNY', 'zh-CN', true),
('EU-DE', 'Germany (EU)', 'country', '["DE"]', 'EUR', 'de-DE', true),
('EU-FR', 'France (EU)', 'country', '["FR"]', 'EUR', 'fr-FR', true),
('UK', 'United Kingdom', 'country', '["GB"]', 'GBP', 'en-GB', true),
('JP', 'Japan', 'country', '["JP"]', 'JPY', 'ja-JP', true),
('APAC', 'Asia Pacific', 'region', '["SG", "MY", "TH", "VN"]', 'USD', 'en-US', false);
```

### 3.2 市场可用性表

```sql
CREATE TABLE product_market_availability (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 可用性控制 ============
    is_available BOOLEAN DEFAULT true COMMENT 'Available in this market',
    available_from TIMESTAMP NULL COMMENT 'Available from date',
    available_until TIMESTAMP NULL COMMENT 'Available until date',
    
    -- ============ 销售渠道 ============
    sales_channels JSON COMMENT 'online, pos, marketplace, social',
    
    -- ============ 限制原因 ============
    restriction_reason VARCHAR(255) COMMENT 'Why restricted if not available',
    
    -- ============ 优先级 ============
    priority INTEGER DEFAULT 0 COMMENT 'Display priority in market',
    
    -- ============ 元数据 ============
    metadata JSON COMMENT 'Market-specific config',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_market (product_id, market_id),
    INDEX idx_market (market_id),
    INDEX idx_available (is_available),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (market_id) REFERENCES markets(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Product availability by market';
```

### 3.3 市场定价表

```sql
CREATE TABLE variant_market_prices (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    variant_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 价格配置 ============
    currency CHAR(3) NOT NULL COMMENT 'ISO 4217',
    price DECIMAL(12,2) NOT NULL COMMENT 'Selling price',
    compare_at_price DECIMAL(12,2) COMMENT 'Original/MSRP price',
    cost_price DECIMAL(12,2) COMMENT 'Cost for margin calculation',
    
    -- ============ 定价策略 ============
    pricing_type VARCHAR(32) DEFAULT 'fixed' COMMENT 'fixed|dynamic|tiered',
    price_calculation_rule JSON COMMENT 'Auto-pricing rules',
    /* 示例:
    {
        "method": "exchange_rate",
        "base_currency": "USD",
        "markup_percentage": 5.0,
        "round_to": 0.99
    }
    */
    
    -- ============ 价格层级（客户群体）============
    customer_group VARCHAR(64) COMMENT 'retail|wholesale|vip|member',
    min_quantity INTEGER COMMENT 'Minimum quantity for this price',
    
    -- ============ 有效期 ============
    effective_from TIMESTAMP NULL COMMENT 'Price effective from',
    effective_until TIMESTAMP NULL COMMENT 'Price effective until',
    
    -- ============ 税务 ============
    tax_inclusive BOOLEAN COMMENT 'Override market default',
    tax_code VARCHAR(64) COMMENT 'Tax category code',
    
    -- ============ 状态 ============
    is_active BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_variant_market (variant_id, market_id),
    INDEX idx_market (market_id),
    INDEX idx_currency (currency),
    INDEX idx_active (is_active, effective_from, effective_until),
    
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE CASCADE,
    FOREIGN KEY (market_id) REFERENCES markets(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Market-specific pricing for variants';
```

### 3.4 汇率表

```sql
CREATE TABLE exchange_rates (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    from_currency CHAR(3) NOT NULL,
    to_currency CHAR(3) NOT NULL,
    rate DECIMAL(18,8) NOT NULL COMMENT 'Exchange rate with high precision',
    
    -- ============ 来源 ============
    source VARCHAR(64) COMMENT 'Rate source: manual, api, central_bank',
    
    -- ============ 有效期 ============
    effective_from TIMESTAMP NOT NULL,
    effective_until TIMESTAMP NULL,
    
    -- ============ 状态 ============
    is_active BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_currencies_date (from_currency, to_currency, effective_from),
    INDEX idx_active (is_active, effective_from),
    INDEX idx_from (from_currency),
    INDEX idx_to (to_currency)
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Exchange rates for multi-currency pricing';
```

## 四、全球库存管理

### 4.1 仓库/库位表

```sql
CREATE TABLE warehouses (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(32) UNIQUE NOT NULL COMMENT 'Warehouse code',
    name VARCHAR(255) NOT NULL,
    
    -- ============ 位置信息 ============
    country CHAR(2) NOT NULL COMMENT 'ISO 3166-1',
    region VARCHAR(100) COMMENT 'State/Province',
    city VARCHAR(100),
    postal_code VARCHAR(20),
    address TEXT,
    latitude DECIMAL(10,8),
    longitude DECIMAL(11,8),
    timezone VARCHAR(64),
    
    -- ============ 仓库类型 ============
    warehouse_type VARCHAR(32) COMMENT 'distribution|fulfillment|dropship|store',
    
    -- ============ 服务市场 ============
    serving_markets JSON COMMENT 'Market codes this warehouse serves',
    
    -- ============ 运营配置 ============
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0 COMMENT 'Fulfillment priority',
    
    -- ============ 联系方式 ============
    contact_name VARCHAR(255),
    contact_phone VARCHAR(50),
    contact_email VARCHAR(255),
    
    -- ============ 元数据 ============
    metadata JSON,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_country (country),
    INDEX idx_active (is_active),
    INDEX idx_priority (priority)
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Global warehouses and fulfillment centers';
```

### 4.2 库存项表

```sql
CREATE TABLE inventory_items (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    variant_id BIGINT UNSIGNED NOT NULL,
    warehouse_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 库存数量 ============
    quantity_on_hand BIGINT DEFAULT 0 COMMENT 'Physical stock',
    quantity_available BIGINT DEFAULT 0 COMMENT 'Available for sale',
    quantity_reserved BIGINT DEFAULT 0 COMMENT 'Reserved/allocated',
    quantity_incoming BIGINT DEFAULT 0 COMMENT 'On order',
    quantity_damaged BIGINT DEFAULT 0 COMMENT 'Damaged/defective',
    
    -- ============ 库存策略 ============
    safety_stock INTEGER DEFAULT 0 COMMENT 'Safety stock level',
    reorder_point INTEGER DEFAULT 0 COMMENT 'Reorder trigger',
    reorder_quantity INTEGER DEFAULT 0 COMMENT 'Reorder amount',
    
    -- ============ 位置信息 ============
    bin_location VARCHAR(100) COMMENT 'Bin/shelf location',
    
    -- ============ 状态 ============
    is_tracked BOOLEAN DEFAULT true COMMENT 'Track inventory for this item',
    
    -- ============ 时间戳 ============
    last_counted_at TIMESTAMP NULL COMMENT 'Last physical count',
    last_restocked_at TIMESTAMP NULL COMMENT 'Last restock',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_variant_warehouse (variant_id, warehouse_id),
    INDEX idx_warehouse (warehouse_id),
    INDEX idx_available (quantity_available),
    
    FOREIGN KEY (variant_id) REFERENCES product_variants(id) ON DELETE CASCADE,
    FOREIGN KEY (warehouse_id) REFERENCES warehouses(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Inventory levels by warehouse';
```

### 4.3 库存历史表

```sql
CREATE TABLE inventory_history (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    inventory_item_id BIGINT UNSIGNED NOT NULL,
    variant_id BIGINT UNSIGNED NOT NULL,
    warehouse_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 变更类型 ============
    transaction_type VARCHAR(32) NOT NULL COMMENT 'purchase|sale|adjustment|transfer|return',
    
    -- ============ 数量变化 ============
    quantity_change BIGINT NOT NULL COMMENT 'Positive or negative',
    quantity_before BIGINT NOT NULL,
    quantity_after BIGINT NOT NULL,
    
    -- ============ 关联信息 ============
    reference_type VARCHAR(64) COMMENT 'Order, PO, Transfer, etc',
    reference_id VARCHAR(64) COMMENT 'Related transaction ID',
    
    -- ============ 原因 ============
    reason VARCHAR(255) COMMENT 'Reason for adjustment',
    notes TEXT,
    
    -- ============ 操作人 ============
    created_by_type VARCHAR(64),
    created_by_id VARCHAR(64),
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_inventory_item (inventory_item_id),
    INDEX idx_variant (variant_id),
    INDEX idx_warehouse (warehouse_id),
    INDEX idx_type (transaction_type),
    INDEX idx_reference (reference_type, reference_id),
    INDEX idx_created (created_at),
    
    FOREIGN KEY (inventory_item_id) REFERENCES inventory_items(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Inventory transaction history';
```

## 五、EAV 灵活属性系统

### 5.1 属性定义表

```sql
CREATE TABLE product_attributes (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(64) UNIQUE NOT NULL COMMENT 'Attribute code: color, size, material',
    
    -- ============ 属性类型 ============
    attribute_type VARCHAR(32) NOT NULL COMMENT 'text|number|boolean|select|multiselect|date',
    input_type VARCHAR(32) NOT NULL COMMENT 'text|textarea|select|checkbox|radio|date',
    
    -- ============ 数据验证 ============
    validation_rules JSON COMMENT 'Validation rules',
    /* 示例:
    {
        "required": true,
        "min_length": 1,
        "max_length": 100,
        "pattern": "^[A-Za-z0-9]+$"
    }
    */
    
    -- ============ 使用范围 ============
    scope VARCHAR(32) DEFAULT 'global' COMMENT 'global|market|locale',
    is_global BOOLEAN DEFAULT true COMMENT 'Same across all markets',
    is_localizable BOOLEAN DEFAULT false COMMENT 'Can be translated',
    is_configurable BOOLEAN DEFAULT false COMMENT 'Used for variants',
    
    -- ============ 显示配置 ============
    is_visible BOOLEAN DEFAULT true,
    is_searchable BOOLEAN DEFAULT false,
    is_filterable BOOLEAN DEFAULT false,
    is_comparable BOOLEAN DEFAULT false,
    
    -- ============ 排序 ============
    position INTEGER DEFAULT 0,
    
    -- ============ 分组 ============
    attribute_group_id BIGINT UNSIGNED COMMENT 'Attribute group',
    
    -- ============ 元数据 ============
    metadata JSON,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_code (code),
    INDEX idx_type (attribute_type),
    INDEX idx_searchable (is_searchable),
    INDEX idx_filterable (is_filterable)
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Product attribute definitions (EAV)';
```

### 5.2 属性翻译表

```sql
CREATE TABLE product_attribute_translations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    attribute_id BIGINT UNSIGNED NOT NULL,
    locale VARCHAR(10) NOT NULL,
    
    label VARCHAR(255) NOT NULL COMMENT 'Display label',
    description TEXT COMMENT 'Attribute description',
    placeholder VARCHAR(255) COMMENT 'Input placeholder',
    help_text TEXT COMMENT 'Help text',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_attribute_locale (attribute_id, locale),
    
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.3 属性选项表（for select/multiselect）

```sql
CREATE TABLE product_attribute_options (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    attribute_id BIGINT UNSIGNED NOT NULL,
    option_value VARCHAR(255) NOT NULL COMMENT 'Internal value',
    
    -- ============ 显示配置 ============
    position INTEGER DEFAULT 0,
    is_default BOOLEAN DEFAULT false,
    
    -- ============ 额外属性（如颜色的hex值）============
    metadata JSON,
    /* 示例 for color:
    {
        "hex": "#FF0000",
        "swatch_image": "red-swatch.jpg"
    }
    */
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_attribute (attribute_id),
    INDEX idx_position (position),
    
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.4 属性选项翻译表

```sql
CREATE TABLE product_attribute_option_translations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    option_id BIGINT UNSIGNED NOT NULL,
    locale VARCHAR(10) NOT NULL,
    
    label VARCHAR(255) NOT NULL COMMENT 'Display label',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_option_locale (option_id, locale),
    
    FOREIGN KEY (option_id) REFERENCES product_attribute_options(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5.5 商品属性值表（EAV Values）

```sql
-- Text/Varchar 值
CREATE TABLE product_attribute_values_varchar (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    attribute_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED COMMENT 'NULL for global',
    locale VARCHAR(10) COMMENT 'NULL for non-localizable',
    
    value VARCHAR(500) NOT NULL,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_attr_market_locale (product_id, attribute_id, market_id, locale),
    INDEX idx_attribute (attribute_id),
    INDEX idx_value (value(100)),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Text 值
CREATE TABLE product_attribute_values_text (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    attribute_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED,
    locale VARCHAR(10),
    
    value TEXT NOT NULL,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_attr_market_locale (product_id, attribute_id, market_id, locale),
    INDEX idx_attribute (attribute_id),
    FULLTEXT idx_value (value),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Integer/Decimal 值
CREATE TABLE product_attribute_values_decimal (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    attribute_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED,
    
    value DECIMAL(20,4) NOT NULL,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_attr_market (product_id, attribute_id, market_id),
    INDEX idx_attribute (attribute_id),
    INDEX idx_value (value),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Datetime 值
CREATE TABLE product_attribute_values_datetime (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    attribute_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED,
    
    value DATETIME NOT NULL,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_attr_market (product_id, attribute_id, market_id),
    INDEX idx_attribute (attribute_id),
    INDEX idx_value (value),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Select/Multiselect 值
CREATE TABLE product_attribute_values_option (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    attribute_id BIGINT UNSIGNED NOT NULL,
    option_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_product_attr_market (product_id, attribute_id, market_id),
    INDEX idx_option (option_id),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (attribute_id) REFERENCES product_attributes(id) ON DELETE CASCADE,
    FOREIGN KEY (option_id) REFERENCES product_attribute_options(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 六、税务与合规

### 6.1 税务分类表

```sql
CREATE TABLE tax_categories (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(64) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    
    -- ============ 默认税率 ============
    default_rate DECIMAL(5,4) COMMENT 'Default tax rate percentage',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 6.2 市场税率表

```sql
CREATE TABLE market_tax_rates (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    market_id BIGINT UNSIGNED NOT NULL,
    tax_category_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 税率配置 ============
    rate DECIMAL(5,4) NOT NULL COMMENT 'Tax rate',
    compound BOOLEAN DEFAULT false COMMENT 'Compound tax',
    
    -- ============ 适用条件 ============
    region VARCHAR(100) COMMENT 'State/Province',
    city VARCHAR(100),
    postal_code_pattern VARCHAR(50) COMMENT 'Postal code pattern',
    
    -- ============ 有效期 ============
    effective_from DATE NOT NULL,
    effective_until DATE NULL,
    
    is_active BOOLEAN DEFAULT true,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_market (market_id),
    INDEX idx_category (tax_category_id),
    INDEX idx_effective (effective_from, effective_until),
    
    FOREIGN KEY (market_id) REFERENCES markets(id) ON DELETE CASCADE,
    FOREIGN KEY (tax_category_id) REFERENCES tax_categories(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Tax rates by market and category';
```

### 6.3 产品税务配置表

```sql
CREATE TABLE product_tax_config (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    market_id BIGINT UNSIGNED COMMENT 'NULL for global',
    
    -- ============ 税务分类 ============
    tax_category_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 税务代码 ============
    tax_code VARCHAR(64) COMMENT 'Product tax code',
    hs_code VARCHAR(16) COMMENT 'Harmonized System code',
    
    -- ============ 豁免 ============
    is_tax_exempt BOOLEAN DEFAULT false,
    exemption_reason VARCHAR(255),
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_product_market (product_id, market_id),
    INDEX idx_market (market_id),
    INDEX idx_category (tax_category_id),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (tax_category_id) REFERENCES tax_categories(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 七、媒体管理

### 7.1 媒体资源表

```sql
CREATE TABLE product_media (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 媒体类型 ============
    media_type VARCHAR(32) NOT NULL COMMENT 'image|video|document|3d_model',
    mime_type VARCHAR(100) NOT NULL,
    
    -- ============ 文件信息 ============
    url TEXT NOT NULL COMMENT 'CDN URL',
    file_size BIGINT COMMENT 'File size in bytes',
    file_name VARCHAR(255),
    
    -- ============ 图片属性 ============
    width INTEGER COMMENT 'Image width',
    height INTEGER COMMENT 'Image height',
    alt_text VARCHAR(500) COMMENT 'Alt text for accessibility',
    
    -- ============ 位置 ============
    position INTEGER DEFAULT 0,
    
    -- ============ 应用范围 ============
    scope VARCHAR(32) DEFAULT 'global' COMMENT 'global|market|variant',
    market_id BIGINT UNSIGNED COMMENT 'Specific market',
    variant_id BIGINT UNSIGNED COMMENT 'Specific variant',
    
    -- ============ 标签 ============
    tags JSON COMMENT 'Media tags',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_product (product_id),
    INDEX idx_type (media_type),
    INDEX idx_market (market_id),
    INDEX idx_variant (variant_id),
    INDEX idx_position (position),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Product media assets';
```

### 7.2 媒体本地化表

```sql
CREATE TABLE product_media_translations (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    media_id BIGINT UNSIGNED NOT NULL,
    locale VARCHAR(10) NOT NULL,
    
    alt_text VARCHAR(500),
    title VARCHAR(255),
    description TEXT,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY idx_media_locale (media_id, locale),
    
    FOREIGN KEY (media_id) REFERENCES product_media(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## 八、物流与配送

### 8.1 运输区域表

```sql
CREATE TABLE shipping_zones (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    market_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(255) NOT NULL,
    
    -- ============ 覆盖区域 ============
    countries JSON COMMENT 'Country codes',
    regions JSON COMMENT 'States/provinces',
    postal_codes JSON COMMENT 'Postal code patterns',
    
    -- ============ 配置 ============
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 0,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_market (market_id),
    
    FOREIGN KEY (market_id) REFERENCES markets(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 8.2 运输限制表

```sql
CREATE TABLE product_shipping_restrictions (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT UNSIGNED NOT NULL,
    
    -- ============ 限制类型 ============
    restriction_type VARCHAR(32) NOT NULL COMMENT 'prohibited|restricted|requires_license',
    
    -- ============ 适用范围 ============
    countries JSON COMMENT 'Restricted countries',
    regions JSON COMMENT 'Restricted regions',
    
    -- ============ 原因 ============
    reason TEXT,
    
    -- ============ 特殊要求 ============
    special_requirements JSON COMMENT 'Special handling requirements',
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_product (product_id),
    INDEX idx_type (restriction_type),
    
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
COMMENT='Product shipping restrictions by region';
```

## 总结

### 关键设计特点

1. **✅ 多市场架
