# 消息领域

## 核心功能
- 消息应用发送消息
- 用户可以查看消息列表
- 用户可以一键阅读
- 触达用户时可以强提醒、阅后即焚等功能
- 消息推送和实时通知
- 消息模板管理
- 消息撤回和编辑
- 消息搜索和过滤
- 消息优先级管理

## 业务场景

### 用户端业务 (user)
- 订单状态通知：订单创建、支付成功、发货提醒等
- 用户互动：评论回复、点赞通知、关注提醒等
- 营销消息：活动推广、优惠券发放、会员权益等
- 安全提醒：登录异常、密码修改、账户安全等

### 商家端业务 (merchant)
- 订单管理：新订单提醒、订单状态变更、退款申请等
- 商品管理：库存预警、商品审核、价格调整等
- 财务管理：收入统计、提现通知、账单提醒等
- 运营通知：活动报名、政策变更、系统维护等

### 管理端业务 (admin)
- 系统监控：性能告警、错误日志、容量预警等
- 运营管理：用户反馈、投诉处理、内容审核等
- 财务管理：资金流水、风险控制、合规提醒等

### 系统业务 (system)
- 系统维护：版本更新、功能发布、维护通知等
- 技术告警：服务异常、数据库告警、网络故障等

## 核心模型

### 应用 (MessageApp)
> 发出消息的应用、可以针对不同的业务线
- 应用编号 (app_id)
- 名称 (name)
- 描述 (description)
- 图标 (icon)
- 所属者 (owner_id)
- 状态 (status: enable/disable)
- 配置信息 (config: 推送配置、模板配置等)
- 创建时间 (created_at)
- 更新时间 (updated_at)

### 消息分类 (MessageCategory)
> 有业务线定义的消息分类
- 分类编号 (id)
- 应用ID (app_id)
- 业务线 (biz: user/merchant/admin/system)
- 分类名称 (name)
- 分类描述 (description)
- 图标 (icon)
- 颜色 (color)
- 排序 (sort)
- 状态 (status: enable/disable)
- 创建时间 (created_at)
- 更新时间 (updated_at)

### 消息模板 (MessageTemplate)
> 消息模板，支持变量替换
- 模板编号 (id)
- 模板名称 (name)
- 模板标题 (title_template)
- 模板内容 (content_template)
- 模板变量 (variables: JSON格式)
- 状态 (status: enable/disable)
- 创建时间 (created_at)
- 更新时间 (updated_at)

### 消息 (Message)
- 消息编号 (id)
- 应用ID (app_id)
- 业务线 (biz: user/merchant/admin/system)
- 分类ID (category_id)
- 接收人 (receiver_id)
- 发送人 (sender_id)
- 模板ID (template_id)
- 消息标题 (title)
- 消息内容 (content)
- 消息数据 (data: JSON格式，包含变量值)
- 消息来源 (source: system/user/api)
- 消息类型 (type: notification/alert/reminder)
- 优先级 (priority: low/normal/high/urgent)
- 状态 (status: unread/read/archived)
- 阅读时间 (read_at)
- 消息渠道 (channels: in_app/push/email/sms)
- 推送状态 (puhs_status: pending/sent/failed)
- 强提醒 (is_urgent: boolean)
- 阅后即焚 (is_burn_after_read: boolean)
- 过期时间 (expires_at)
- 操作人 (operator_id)
- 创建时间 (created_at)
- 更新时间 (updated_at)

### 消息推送记录 (MessagePushLog)
> 记录消息推送的详细日志
- 推送编号 (id)
- 消息ID (message_id)
- 推送渠道 (channel: in_app/push/email/sms)
- 推送状态 (status: pending/sent/failed)
- 推送时间 (pushed_at)
- 错误信息 (error_message)
- 重试次数 (retry_count)
- 创建时间 (created_at)



## 扩展功能

### 消息规则引擎
- 消息发送规则配置
- 消息频率限制
- 消息时间窗口控制
- 用户偏好设置

### 消息渠道管理
- 多渠道配置 (APP内、推送、邮件、短信)
- 渠道优先级设置
- 渠道状态监控
- 渠道成本统计

### 消息模板系统
- 富文本模板编辑器
- 变量替换引擎
- 模板版本管理
- 模板预览功能

### 消息分析报表
- 用户阅读行为分析
- 消息效果评估
- 用户反馈统计

## 技术要求

### 性能要求
- 支持高并发消息发送
- 消息查询响应时间 < 100ms
- 支持消息队列异步处理
- 支持消息缓存优化

### 可靠性要求
- 消息发送成功率 > 99.9%
- 消息不丢失、不重复
- 支持消息重试机制
- 支持消息备份恢复

### 扩展性要求
- 支持水平扩展
- 支持多租户架构
- 支持插件化扩展
- 支持API接口开放

### 安全性要求
- 消息内容加密存储
- 用户隐私保护
- 消息权限控制
- 操作日志审计
