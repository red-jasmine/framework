@startuml message-database-relation

!theme plain
entity 消息应用表 {
    * id : bigint
    --
    * name : varchar(100)
    description : text
    icon : varchar(255)
    * owner_id : bigint
    * status : enum('enable','disable')
    config : json
    * created_at : timestamp
    * updated_at : timestamp
}

entity 消息分类表 {
    * id : bigint
    --
    * app_id : bigint
    * biz : enum('user','merchant','admin','system')
    * name : varchar(100)
    description : text
    icon : varchar(255)
    color : varchar(20)
    sort : int
    * status : enum('enable','disable')
    * created_at : timestamp
    * updated_at : timestamp
}

entity 消息模板表 {
    * id : bigint
    --
    * name : varchar(100)
    * title_template : text
    * content_template : text
    variables : json
    * status : enum('enable','disable')
    * created_at : timestamp
    * updated_at : timestamp
}

entity 消息表 {
    * id : bigint
    --
    * app_id : bigint
    * biz : enum('user','merchant','admin','system')
    category_id : bigint
    * receiver_id : bigint
    sender_id : bigint
    template_id : bigint
    * title : varchar(255)
    * content : text
    data : json
    * source : enum('system','user','api')
    * type : enum('notification','alert','reminder')
    * priority : enum('low','normal','high','urgent')
    * status : enum('unread','read','archived')
    read_at : timestamp
    channels : json
    * push_status : enum('pending','sent','failed')
    * is_urgent : boolean
    * is_burn_after_read : boolean
    expires_at : timestamp
    operator_id : bigint
    * created_at : timestamp
    * updated_at : timestamp
}

entity 推送日志表 {
    * id : bigint
    --
    * message_id : bigint
    * channel : enum('in_app','push','email','sms')
    * status : enum('pending','sent','failed')
    pushed_at : timestamp
    error_message : text
    retry_count : int
    * created_at : timestamp
}

消息应用表 ||--o{ 消息分类表 : app_id
消息应用表 ||--o{ 消息表 : app_id
消息分类表 ||--o{ 消息表 : category_id
消息模板表 ||--o{ 消息表 : template_id
消息表 ||--o{ 推送日志表 : message_id

@enduml
