---
title: 分销
outline: deep
order: 5
---

# 分销

## 概述

分销系统，电商流程中用户分享的商品，通过佣金的方式获得佣金。

- 分销员推荐后形成推广树关系分佣
- 分销员通过推广链接分享商品给用户分佣

## 用例分析

### 参与角色

- 分销员
	- 佣金
	- 提现方式
- 管理员
- 用户
	- 订单
	- 注册
- 商家
	- 商品

### 连接领域

- 用户
- 商品
- 订单
- 商家
- 支付

### 核心用例

#### 招募分销员

> 分销员通过邀请码或二维码进行推广，邀请用户注册，用户注册成功后成为分销员。

- 主流程
	1. 管理员 设置招募条件
	2. 用户申请成为分销员
	3. 管理员审核分销员

#### 分销员推广商品、获得佣金

> 分销员通过各种渠道推广商品，用户下单后，分销员获得佣金。

- 参与者: 分销员、用户
- 主流程
	- 分销员推广商品
	- 用户下单、完成订单
	- 冻结佣金、订单完成后发放佣金

#### 分销员邀请码、邀请链接与邀请海报设计方案

### 一、邀请码设计

1. **邀请码生成规则**
   - 每个分销员注册/审核通过后自动生成唯一的邀请码（如6-8位字母+数字组合，避免歧义字符）。
   - 邀请码与分销员ID一一对应，支持后续溯源。
   - 邀请码可设置有效期或长期有效，支持失效与重置。

2. **邀请码存储**
   - 存储于分销员表（如promoters）字段 `invitation_code`，需唯一索引。
   - 生成时校验唯一性，防止冲突。

3. **邀请码使用场景**
   - 新用户注册时填写邀请码，自动绑定上下级关系。
   - 后台可查询每个邀请码的使用情况。

### 二、邀请链接设计

1. **链接生成方式**
   - 格式示例：https://yourdomain.com/register?invite=邀请码
   - 支持推广商品时附带商品ID参数：https://yourdomain.com/product/123?invite=邀请码
   - 链接可通过前端或API动态生成，便于分销员分享。

2. **链接跳转逻辑**
   - 用户访问链接后，自动记录邀请码（可存于session/cookie），注册时自动带入。
   - 若已登录则直接绑定关系，未登录则在注册流程中提示邀请码。

3. **安全与防刷**
   - 限制同一设备/账号短时间内多次使用同一邀请码。
   - 后台可监控异常邀请行为。

### 三、邀请海报设计

1. **海报内容要素**
   - 分销员头像/昵称（提升信任感）
   - 邀请二维码（扫码即带邀请码参数）
   - 简要文案（如"扫码注册，立享优惠"）
   - 平台Logo、活动信息等

2. **二维码生成**
   - 二维码内容为邀请链接，扫码自动跳转注册/商品页并带邀请码。
   - 可使用后端服务生成带参数的二维码图片，或前端调用API生成。

3. **海报生成方式**
   - 前端H5页面动态生成（canvas绘制），或后端生成图片URL供分销员下载/分享。
   - 支持自定义模板，适配不同活动场景。

4. **技术实现建议**
   - 推荐使用如 `endroid/qr-code`（PHP）等库生成二维码。
   - 海报模板可用PSD/Sketch设计，前端/后端渲染时动态填充分销员信息。

### 四、业务流程示意

1. 分销员获取邀请码、邀请链接、海报
2. 分享给好友或社群
3. 新用户通过链接/扫码注册，自动绑定上下级关系
4. 后台统计邀请数据，分销员获得邀请奖励

```plantuml
<!--@include: ./core_flow.puml-->
```

#### 分销员升级

> 分销员升级，分销员升级条件满足后，分销员升级。

- 参与者: 分销员、管理员
- 主流程
	- 管理员设置升级条件
	- 分销员升级

#### 分销员提现

> 分销员提现

- 参与者: 分销员、管理员
- 主流程
	- 分销员提现
	- 设置提现手续费、以及个税
	- 管理员审核提现
	- 支付系统打款

#### 分销员团队管理

>
分销员团队管理，查看分销员团队信息、查看分销员团队业绩、查看分销员团队成员、查看分销员团队成员业绩、查看分销员团队成员关系、查看分销员团队成员关系业绩、查看分销员团队成员关系业绩排名、查看分销员团队成员关系业绩占比、查看分销员团队成员关系业绩占比排名、查看分销员团队成员关系业绩占比排名百分比、查看分销员团队成员关系业绩

- 参与者: 分销员、管理员

## 统一语言表

| 名称                  | 中文         | 备注                           |
| --------------------- | ------------ | ------------------------------ |
| Scene                 | 场景         | 场景如邀请、推广佣金           |
| Promoter              | 分销员       | 拥有分销资格的用户             |
| PromoterLevel         | 分销员等级   | 分销员等级                     |
| PromotionRelationship | 推广关系     | 表示分销员之间上下级关系       |
| PromotionRecord       | 推广业绩记录 | 分销订单                       |
| Commission            | 佣金         | 佣金                           |
| InvitationCode        | 邀请码       | 邀请用户注册                   |
| InvitationCommission  | 邀请佣金     | 通过邀请下级用户购买产生的佣金 |
| ProductCommission     | 商品佣金     | 通过推广商品促成下单的佣金     |

## 领域事件

- 分销员申请事件
- 分销员审核事件
- 分销员升级事件
- 分销员降级事件
- 分销员提现事件
- 团队成立事件
- 团队成员加入事件
- 团队成员退出事件
- 分销订单结算事件