@startuml
'https://plantuml.com/sequence-diagram

autonumber

actor 分销员
actor 用户
participant 推广系统
participant 订单系统
participant 支付系统
participant 佣金系统
participant 提现系统

== 推广阶段 ==
分销员 -> 推广系统: 获取推广链接(商品ID)
推广系统 --> 分销员: 返回带参数的推广链接
分销员 -> 用户: 分享推广链接

== 购买阶段 ==
用户 -> 推广系统: 点击推广链接
推广系统 -> 推广系统: 记录推广关系(用户ID,分销员ID,商品ID)
推广系统 --> 用户: 跳转商品详情页
用户 -> 订单系统: 下单购买商品
订单系统 -> 推广系统: 验证推广关系
推广系统 --> 订单系统: 返回有效推广关系
订单系统 -> 支付系统: 创建支付单
用户 -> 支付系统: 完成支付
支付系统 --> 订单系统: 支付成功通知
订单系统 -> 订单系统: 标记订单为已支付

== 佣金结算阶段 ==
订单系统 -> 订单系统: 订单完成(确认收货)
订单系统 -> 佣金系统: 触发佣金结算(订单ID,推广关系)
佣金系统 -> 佣金系统: 计算佣金(商品金额×分佣比例)
佣金系统 -> 佣金系统: 冻结佣金(订单完成后N天解冻)
佣金系统 --> 分销员: 推送佣金到账通知

== 提现阶段 ==
分销员 -> 提现系统: 发起提现申请(金额)
提现系统 -> 提现系统: 计算手续费和税费
提现系统 -> 提现系统: 审核提现申请
提现系统 -> 支付系统: 发起打款
支付系统 --> 提现系统: 打款结果通知
提现系统 -> 佣金系统: 更新佣金状态(已提现)
提现系统 --> 分销员: 推送提现结果通知

@enduml