---
alwaysApply: true
description: "Red Jasmine Framework 项目架构规则和DDD设计原则"
---

# Red Jasmine Framework 项目架构

## 项目概述
Red Jasmine Framework 是一个基于 Laravel 12.0+ 和 PHP 8.2+ 的现代化电商框架，采用领域驱动设计（DDD）架构，通过模块化的方式构建可扩展的电商系统。

## 技术栈要求
- PHP 8.2+
- Laravel 12.0+
- 依赖管理编辑器: Composer
- 遵循PSR-12编码标准

## DDD 架构原则
- **领域优先**: 领域模型是系统的核心，业务逻辑应该在领域层实现
- **依赖倒置**: 外层依赖内层，基础设施层依赖领域层
- **职责清晰**: 每层都有明确的职责边界
- **模块化**: 每个领域包都是独立的模块，可以单独开发和部署

## 包命名规范
- 使用英文小写命名
- 使用短横线分隔多个单词
- 体现业务领域概念
- 例如：`article`、`user`、`order`、`product`等

## 目录结构

### 整体架构
```
framework/
├── packages/                   # 核心包存放目录
│   ├── support/                # 公共支持包
│   ├── *                       # 各个业务领域包
│   └── admin/                  # 管理后台领域
├── filament/                   # 基于Filament构建的管理端包目录
│   └── filament-*/             # 各个Filament管理模块
├── docs/                       # 文档目录
├── tests/                      # 测试目录
├── workbench/                  # 开发工作台
└── vendor/                     # Composer依赖
```

### 领域包结构
每个领域包都遵循统一的目录结构：

```
{domain}
├── src/                        # 源代码
│   ├── Domain/                 # 领域层
│   │   ├── Models/             # 领域模型
│   │   │   ├── Enums/          # 枚举定义
│   │   │   └── ValueObjects/   # 值对象
│   │   ├── Contracts/          # 外部服务接口定义
│   │   ├── Repositories/       # 仓库接口
│   │   ├── Data/               # 基础DTO
│   │   ├── Transformers/       # 转换器
│   │   ├── Events/             # 领域事件
│   │   ├── Services/           # 领域服务
│   │   ├── Contracts/          # 领域契约
│   │   └── Facades/            # 门面类
│   ├── Application/            # 应用层
│   │   └── Services/           # 应用服务
│   │       ├────── Commands/       # 命令定义和 命令处理器
│   │       └────── Queries/        # 查询定义和 查询处理器
│   ├── Infrastructure/         # 基础设施层
│   │   └── Repositories/       # 仓库实现
│   ├── UI/                     # 用户接口层
│   │   └── Http/               # HTTP接口
│   │       ├── Admin/          # 管理员接口 （按需）
│   │       │   ├── {domain}{role}Route.php # 路由定义文件
│   │       │   ├── Api/
│   │       │   │   ├── Controllers/  #控制器
│   │       │   │   ├── Requests/     # 请求验证
│   │       │   │   ├── Resources/    # 响应资源
│   │       │   │   └── Middlewares/  # 路由中间件
│   │       │   └── Web/
│   │       ├── User/           # 用户接口 （按需）
│   │       └── Owner/          # 所有者接口
│   └── Exceptions/             # 异常处理
├── config/                     # 配置文件
├── database/                   # 数据库相关
│   └── migrations/             # 数据库迁移
├── routes/                     # 路由定义
├── resources/                  # 资源文件
│   ├── lang/                   # 语言文件
│   └── views/                  # 视图文件
├── composer.json               # 包配置
└── README.md                   # 包说明
```

## 服务提供者 (Service Provider)

### 规范
- **基类继承**: 继承 `Spatie\LaravelPackageTools\PackageServiceProvider`
- **命名规范**: 服务提供者类名格式为 `{Domain}PackageServiceProvider`
- **文件位置**: 位于 `src/{Domain}PackageServiceProvider.php`
- **静态属性**: 定义 `$name` 和 `$viewNamespace` 静态属性
- **配置方法**: 实现 `configurePackage()` 方法配置包功能
- **命令管理**: 实现 `getCommands()` 方法返回命令列表
- **迁移管理**: 实现 `getMigrations()` 方法返回迁移文件列表

### 必需配置
- **包名称**: 使用 `red-jasmine-{domain}` 格式
- **视图命名空间**: 使用 `red-jasmine-{domain}` 格式
- **路由注册**: 根据需求注册 `api` 或 `web` 路由
- **迁移文件**: 通过 `getMigrations()` 方法管理迁移文件列表
- **安装命令**: 配置安装命令，包括配置发布、迁移执行等

### 代码示例
```php
class ProductPackageServiceProvider extends PackageServiceProvider
{
    public static string $name = 'red-jasmine-product';
    public static string $viewNamespace = 'red-jasmine-product';

    public function configurePackage(Package $package): void
    {
        $package->name(static::$name)
                ->hasCommands($this->getCommands())
                ->runsMigrations()
                ->hasRoutes(['api'])
                ->hasInstallCommand(function (InstallCommand $command) {
                    $command
                        ->publishConfigFile()
                        ->askToRunMigrations()
                        ->endWith(function (InstallCommand $command) {
                            if ($command->confirm('Seed demo data')) {
                                $command->call('db:seed', ['--class' => ProductPackageSeeder::class]);
                            }
                        });
                });

        $configFileName = $package->shortName();

        // 条件性加载配置文件
        if (file_exists($package->basePath("/../config/{$configFileName}.php"))) {
            $package->hasConfigFile();
        }

        // 条件性加载迁移文件
        if (file_exists($package->basePath('/../database/migrations'))) {
            $package->hasMigrations($this->getMigrations());
        }

        // 条件性加载翻译文件
        if (file_exists($package->basePath('/../resources/lang'))) {
            $package->hasTranslations();
        }

        // 条件性加载视图文件
        if (file_exists($package->basePath('/../resources/views'))) {
            $package->hasViews(static::$viewNamespace);
        }
    }

    public function getCommands(): array
    {
        return [];
    }

    public function getMigrations(): array
    {
        return [
            'create_products_table',
            'create_product_categories_table',
            // ... 更多迁移文件
        ];
    }
}
```

### 配置说明
- **条件性加载**: 使用 `file_exists()` 检查文件是否存在后再加载相应资源
- **迁移文件命名**: 迁移文件名应清晰表达其功能，使用下划线分隔
- **安装命令**: 可根据需要配置安装命令，包括数据填充等操作
- **路由注册**: 根据包的实际需求注册 `api` 或 `web` 路由
